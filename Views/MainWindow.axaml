<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:BereitschaftsPlaner.Avalonia.ViewModels"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d" d:DesignWidth="1200" d:DesignHeight="800"
        x:Class="BereitschaftsPlaner.Avalonia.Views.MainWindow"
        x:DataType="vm:MainWindowViewModel"
        Icon="/Assets/avalonia-logo.ico"
        Title="Bereitschafts-Planer | Yunex Traffic"
        Width="1200" Height="800"
        Background="{DynamicResource SurfaceBrush}"
        FontFamily="{DynamicResource SansFont}"
        FontSize="14">

    <Design.DataContext>
        <vm:MainWindowViewModel/>
    </Design.DataContext>

    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="220"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <!-- ============================================================================ -->
        <!-- SIDEBAR - Minimal Clean Navigation -->
        <!-- ============================================================================ -->
        <Border Grid.Column="0"
                Background="{DynamicResource CardBrush}"
                BorderBrush="#F0F0F0"
                BorderThickness="0,0,1,0">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- Logo Area - Minimal -->
                <Border Grid.Row="0" Padding="24,32,24,24">
                    <StackPanel Spacing="4">
                        <TextBlock Text="Bereitschafts-Planer"
                                   Classes="H2"
                                   FontSize="20"
                                   TextWrapping="Wrap"/>
                        <TextBlock Text="Yunex Traffic"
                                   Classes="Label"
                                   Opacity="0.6"/>
                    </StackPanel>
                </Border>

                <!-- Navigation Items -->
                <StackPanel Grid.Row="1" Margin="16,0" Spacing="4">
                    <Button Command="{Binding NavigateToImportCommand}"
                            Classes="NavItem"
                            HorizontalContentAlignment="Left"
                            HorizontalAlignment="Stretch">
                        <TextBlock Text="Import" Classes="Body" FontWeight="Medium"/>
                    </Button>

                    <Button Command="{Binding NavigateToZeitprofileCommand}"
                            Classes="NavItem"
                            HorizontalContentAlignment="Left"
                            HorizontalAlignment="Stretch">
                        <TextBlock Text="Zeitprofile" Classes="Body" FontWeight="Medium"/>
                    </Button>

                    <Button Command="{Binding NavigateToGeneratorCommand}"
                            Classes="NavItem"
                            HorizontalContentAlignment="Left"
                            HorizontalAlignment="Stretch">
                        <TextBlock Text="Erstellung" Classes="Body" FontWeight="Medium"/>
                    </Button>

                    <Button Command="{Binding NavigateToPlanningCommand}"
                            Classes="NavItem"
                            HorizontalContentAlignment="Left"
                            HorizontalAlignment="Stretch">
                        <TextBlock Text="Planung" Classes="Body" FontWeight="Medium"/>
                    </Button>

                    <Button Command="{Binding NavigateToEditorCommand}"
                            Classes="NavItem"
                            HorizontalContentAlignment="Left"
                            HorizontalAlignment="Stretch">
                        <TextBlock Text="Editor" Classes="Body" FontWeight="Medium"/>
                    </Button>
                </StackPanel>

                <!-- Footer -->
                <Border Grid.Row="2"
                        Padding="24,16"
                        BorderBrush="#F0F0F0"
                        BorderThickness="0,1,0,0">
                    <TextBlock Text="Â© 2025 Johannes Hehl"
                               Classes="Label"
                               TextWrapping="Wrap"
                               Opacity="0.5"/>
                </Border>
            </Grid>
        </Border>

        <!-- ============================================================================ -->
        <!-- CONTENT AREA -->
        <!-- ============================================================================ -->
        <Grid Grid.Column="1" Background="{DynamicResource SurfaceBrush}">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <!-- Top Bar - Clean Minimal -->
            <Border Grid.Row="0"
                    Background="{DynamicResource CardBrush}"
                    BorderBrush="#F0F0F0"
                    BorderThickness="0,0,0,1"
                    Padding="24,16">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <TextBlock Grid.Column="0"
                               Text=""
                               VerticalAlignment="Center"/>

                    <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="12" Margin="0,0,24,0">
                        <Button Command="{Binding OpenSettingsCommand}"
                                Classes="SecondaryAction"
                                HorizontalContentAlignment="Center"
                                Content="Features"/>

                        <Button Command="{Binding OpenBackupManagementCommand}"
                                Classes="SecondaryAction"
                                HorizontalContentAlignment="Center"
                                Content="Backup"/>
                    </StackPanel>

                    <StackPanel Grid.Column="2" Orientation="Horizontal" Spacing="12" Margin="0,0,24,0">
                        <TextBlock Text="Umgebung"
                                   Classes="Label"
                                   VerticalAlignment="Center"
                                   Margin="0,0,8,0"/>
                        <ComboBox SelectedIndex="{Binding EnvironmentIndex}"
                                  MinWidth="110"
                                  FontSize="13">
                            <ComboBoxItem Content="Production"/>
                            <ComboBoxItem Content="QA"/>
                        </ComboBox>
                    </StackPanel>

                    <!-- Dark Mode Toggle - Temporarily disabled (only Light Mode)
                    <StackPanel Grid.Column="3" Orientation="Horizontal" Spacing="12">
                        <TextBlock Text="Theme"
                                   Classes="Label"
                                   VerticalAlignment="Center"
                                   Margin="0,0,8,0"/>
                        <ToggleSwitch IsChecked="{Binding IsDarkMode}"
                                      OffContent="Light"
                                      OnContent="Dark"
                                      FontSize="13"/>
                    </StackPanel>
                    -->
                </Grid>
            </Border>

            <!-- View Content -->
            <ScrollViewer Grid.Row="1"
                          HorizontalScrollBarVisibility="Disabled"
                          VerticalScrollBarVisibility="Auto">
                <Grid Margin="40">

                    <!-- ====================================================================== -->
                    <!-- VIEW 1: IMPORT -->
                    <!-- ====================================================================== -->
                    <StackPanel IsVisible="{Binding IsImportView}" Spacing="32">
                        <TextBlock Text="Setup" Classes="H1"/>

                        <Grid>
                            <TextBlock Text="IMPORT VON RESSOURCEN UND BEREITSCHAFTSGRUPPEN"
                                       Classes="Label"
                                       VerticalAlignment="Center"/>

                            <Button Content="âš™ï¸ Spalten-Zuordnung"
                                    Command="{Binding OpenExcelImportSettingsCommand}"
                                    Classes="SecondaryAction"
                                    HorizontalAlignment="Right"
                                    HorizontalContentAlignment="Center"
                                    Height="32"
                                    Padding="12,0"/>
                        </Grid>

                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="30"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <!-- Ressourcen -->
                            <StackPanel Grid.Column="0" Spacing="24">
                                <TextBlock Text="Ressourcen" Classes="H2"/>

                                <Border Classes="BentoCard">
                                    <StackPanel Spacing="16">
                                        <TextBlock Text="EXCEL-DATEI" Classes="Label"/>

                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="12"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>

                                            <TextBox Grid.Column="0"
                                                     Text="{Binding ExcelFilePath}"
                                                     IsReadOnly="True"
                                                     Watermark="Keine Datei ausgewÃ¤hlt"/>

                                            <Button Grid.Column="2"
                                                    Content="Durchsuchen"
                                                    Classes="SecondaryAction"
                                                    Command="{Binding BrowseFileCommand}"/>
                                        </Grid>

                                        <Button Content="Excel importieren"
                                                Classes="TrustAction"
                                                Command="{Binding ImportExcelCommand}"/>
                                    </StackPanel>
                                </Border>

                                <Border Classes="BentoCard">
                                    <StackPanel Spacing="16">
                                        <TextBlock Text="SBP LINK" Classes="Label"/>
                                        <Button Content="ðŸ“‹ Ressourcen in SBP Ã¶ffnen"
                                                Classes="SecondaryAction"
                                                HorizontalContentAlignment="Center"
                                                Command="{Binding OpenSBPBookableResourcesCommand}"
                                                ToolTip.Tip="Excel-Export fÃ¼r Ressourcen-Import"/>
                                    </StackPanel>
                                </Border>

                                <Border Classes="BentoCard" ClipToBounds="True">
                                    <StackPanel Spacing="16">
                                        <TextBlock Text="{Binding DataGridTitle}" Classes="H2" FontSize="18"/>

                                        <ScrollViewer Height="250"
                                                      VerticalScrollBarVisibility="Auto"
                                                      HorizontalScrollBarVisibility="Disabled">
                                            <ItemsControl ItemsSource="{Binding Ressourcen}">
                                                <ItemsControl.ItemTemplate>
                                                    <DataTemplate>
                                                        <Border BorderBrush="{DynamicResource BorderBrush}"
                                                                BorderThickness="0,0,0,1"
                                                                Padding="12,8">
                                                            <TextBlock Text="{Binding}"
                                                                       Classes="Body"
                                                                       TextWrapping="Wrap"
                                                                       MaxWidth="800"/>
                                                        </Border>
                                                    </DataTemplate>
                                                </ItemsControl.ItemTemplate>
                                            </ItemsControl>
                                        </ScrollViewer>

                                        <TextBlock Text="Keine Daten vorhanden"
                                                   Classes="Body"
                                                   Foreground="{DynamicResource TextMutedBrush}"
                                                   HorizontalAlignment="Center"
                                                   FontStyle="Italic"
                                                   IsVisible="{Binding !HasData}"/>
                                    </StackPanel>
                                </Border>
                            </StackPanel>

                            <!-- Bereitschaftsgruppen -->
                            <StackPanel Grid.Column="2" Spacing="24">
                                <TextBlock Text="Bereitschaftsgruppen" Classes="H2"/>

                                <Border Classes="BentoCard">
                                    <StackPanel Spacing="16">
                                        <TextBlock Text="EXCEL-DATEI" Classes="Label"/>

                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="12"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>

                                            <TextBox Grid.Column="0"
                                                     Text="{Binding GruppenFilePath}"
                                                     IsReadOnly="True"
                                                     Watermark="Keine Datei ausgewÃ¤hlt"/>

                                            <Button Grid.Column="2"
                                                    Content="Durchsuchen"
                                                    Classes="SecondaryAction"
                                                    Command="{Binding BrowseGruppenFileCommand}"/>
                                        </Grid>

                                        <Button Content="Excel importieren"
                                                Classes="TrustAction"
                                                Command="{Binding ImportGruppenCommand}"/>
                                    </StackPanel>
                                </Border>

                                <Border Classes="BentoCard">
                                    <StackPanel Spacing="16">
                                        <TextBlock Text="SBP LINK" Classes="Label"/>
                                        <Button Content="ðŸ“‹ Gruppen in SBP Ã¶ffnen"
                                                Classes="SecondaryAction"
                                                HorizontalContentAlignment="Center"
                                                Command="{Binding OpenSBPOnCallGroupsCommand}"
                                                ToolTip.Tip="Excel-Export fÃ¼r Gruppen-Import"/>
                                    </StackPanel>
                                </Border>

                                <Border Classes="BentoCard" ClipToBounds="True">
                                    <StackPanel Spacing="16">
                                        <TextBlock Text="Importierte Gruppen" Classes="H2" FontSize="18"/>

                                        <ScrollViewer Height="250"
                                                      VerticalScrollBarVisibility="Auto"
                                                      HorizontalScrollBarVisibility="Disabled">
                                            <ItemsControl ItemsSource="{Binding BereitschaftsGruppen}">
                                                <ItemsControl.ItemTemplate>
                                                    <DataTemplate>
                                                        <Border BorderBrush="{DynamicResource BorderBrush}"
                                                                BorderThickness="0,0,0,1"
                                                                Padding="12,8">
                                                            <TextBlock Text="{Binding}"
                                                                       Classes="Body"
                                                                       TextWrapping="Wrap"
                                                                       MaxWidth="800"/>
                                                        </Border>
                                                    </DataTemplate>
                                                </ItemsControl.ItemTemplate>
                                            </ItemsControl>
                                        </ScrollViewer>

                                        <TextBlock Text="Keine Daten vorhanden"
                                                   Classes="Body"
                                                   Foreground="{DynamicResource TextMutedBrush}"
                                                   HorizontalAlignment="Center"
                                                   FontStyle="Italic"
                                                   IsVisible="{Binding !HasGruppenData}"/>
                                    </StackPanel>
                                </Border>
                            </StackPanel>
                        </Grid>

                        <Border Classes="BentoCard" Background="#FAFAFA">
                            <StackPanel Spacing="8">
                                <TextBlock Text="TECHNOLOGIE-STACK" Classes="Label"/>
                                <TextBlock TextWrapping="Wrap" Classes="Body" Foreground="{DynamicResource TextMutedBrush}">
                                    <Run Text="Avalonia 11.3.10 (Cross-Platform UI) â€¢ "/><Run Text="LiteDB 5.0.21 (NoSQL Database) â€¢ "/><Run Text="ExcelDataReader (PlattformunabhÃ¤ngig) â€¢ "/><Run Text=".NET 9.0 + MVVM Pattern"/>
                                </TextBlock>
                            </StackPanel>
                        </Border>
                    </StackPanel>

                    <!-- ====================================================================== -->
                    <!-- VIEW 2: ZEITPROFILE -->
                    <!-- ====================================================================== -->
                    <StackPanel IsVisible="{Binding IsZeitprofileView}" Spacing="32">
                        <TextBlock Text="Zeitprofile" Classes="H1"/>
                        <TextBlock Text="BEREITSCHAFTSDIENST UND TAGESDIENST KONFIGURIEREN" Classes="Label"/>

                        <Border Classes="BentoCard">
                            <StackPanel Spacing="20">
                                <TextBlock Text="PROFIL-VERWALTUNG" Classes="Label"/>

                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="12"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>

                                    <TextBlock Grid.Column="0"
                                               Text="Aktives Profil"
                                               Classes="Body"
                                               FontWeight="Bold"
                                               VerticalAlignment="Center"
                                               Margin="0,0,16,0"/>

                                    <ComboBox Grid.Column="1"
                                              ItemsSource="{Binding ZeitprofileVM.Zeitprofile}"
                                              SelectedItem="{Binding ZeitprofileVM.SelectedZeitprofil}"
                                              MinWidth="300"/>

                                    <StackPanel Grid.Column="3" Orientation="Horizontal" Spacing="8">
                                        <Button Content="Speichern"
                                                Classes="TrustAction"
                                                Command="{Binding ZeitprofileVM.SaveSelectedProfilCommand}"/>

                                        <Button Content="Kopieren"
                                                Classes="SecondaryAction"
                                                Command="{Binding ZeitprofileVM.CopySelectedProfilCommand}"/>

                                        <Button Content="LÃ¶schen"
                                                Classes="SecondaryAction"
                                                Command="{Binding ZeitprofileVM.DeleteSelectedProfilCommand}"/>
                                    </StackPanel>
                                </Grid>

                                <Separator Background="#F0F0F0" Height="1" Margin="0,8"/>

                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="12"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>

                                    <TextBlock Grid.Column="0"
                                               Text="Neues Profil"
                                               Classes="Body"
                                               FontWeight="Bold"
                                               VerticalAlignment="Center"
                                               Margin="0,0,16,0"/>

                                    <TextBox Grid.Column="1"
                                             Text="{Binding ZeitprofileVM.NewProfilName}"
                                             Watermark="Name fÃ¼r neues Profil"/>

                                    <Button Grid.Column="3"
                                            Content="Erstellen"
                                            Classes="TrustAction"
                                            Command="{Binding ZeitprofileVM.CreateNewProfilCommand}"/>
                                </Grid>

                                <TextBlock Text="{Binding ZeitprofileVM.StatusMessage}"
                                           Foreground="{Binding ZeitprofileVM.StatusColor}"
                                           Classes="Body"
                                           FontWeight="Medium"/>
                            </StackPanel>
                        </Border>

                        <Border Classes="BentoCard"
                                IsVisible="{Binding ZeitprofileVM.SelectedZeitprofil, Converter={x:Static ObjectConverters.IsNotNull}}">
                            <StackPanel Spacing="20">
                                <TextBlock Text="PROFIL-DETAILS" Classes="Label"/>

                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>

                                    <TextBlock Grid.Column="0"
                                               Text="Profil-Name"
                                               Classes="Body"
                                               FontWeight="Bold"
                                               VerticalAlignment="Center"
                                               Margin="0,0,16,0"/>

                                    <TextBox Grid.Column="1"
                                             Text="{Binding ZeitprofileVM.SelectedZeitprofil.Name}"
                                             Watermark="Profilname"/>
                                </Grid>
                            </StackPanel>
                        </Border>

                        <Border Classes="BentoCard"
                                IsVisible="{Binding ZeitprofileVM.SelectedZeitprofil, Converter={x:Static ObjectConverters.IsNotNull}}">
                            <StackPanel Spacing="24">
                                <TextBlock Text="WOCHENZEITPLAN" Classes="Label"/>

                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="30"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>

                                    <StackPanel Grid.Column="0" Spacing="12">
                                        <TextBlock Text="Bereitschaftsdienst" Classes="H2" FontSize="18"/>

                                        <DataGrid ItemsSource="{Binding ZeitprofileVM.SelectedZeitprofil.BereitschaftsTage}"
                                                  AutoGenerateColumns="False"
                                                  Height="220">
                                            <DataGrid.Columns>
                                                <DataGridTextColumn Header="Tag" Binding="{Binding Tag}" Width="*" IsReadOnly="True"/>
                                                <DataGridTextColumn Header="Von" Binding="{Binding Von}" Width="80"/>
                                                <DataGridTextColumn Header="Bis" Binding="{Binding Bis}" Width="80"/>
                                            </DataGrid.Columns>
                                        </DataGrid>

                                        <TextBlock Text="Standard: Mo-So 16:00-07:30"
                                                   Classes="Body"
                                                   Foreground="{DynamicResource TextMutedBrush}"
                                                   FontStyle="Italic"
                                                   FontSize="13"/>
                                    </StackPanel>

                                    <StackPanel Grid.Column="2" Spacing="12">
                                        <TextBlock Text="Tagesdienst" Classes="H2" FontSize="18"/>

                                        <DataGrid ItemsSource="{Binding ZeitprofileVM.SelectedZeitprofil.Tagesdienste}"
                                                  AutoGenerateColumns="False"
                                                  Height="220">
                                            <DataGrid.Columns>
                                                <DataGridTextColumn Header="Tag" Binding="{Binding Tag}" Width="*" IsReadOnly="True"/>
                                                <DataGridTextColumn Header="Von" Binding="{Binding Von}" Width="80"/>
                                                <DataGridTextColumn Header="Bis" Binding="{Binding Bis}" Width="80"/>
                                            </DataGrid.Columns>
                                        </DataGrid>

                                        <TextBlock Text="Standard: Mo-Do 07:30-16:00, Fr 07:30-12:30"
                                                   Classes="Body"
                                                   Foreground="{DynamicResource TextMutedBrush}"
                                                   FontStyle="Italic"
                                                   FontSize="13"/>
                                    </StackPanel>
                                </Grid>
                            </StackPanel>
                        </Border>

                        <Border Classes="BentoCard"
                                IsVisible="{Binding ZeitprofileVM.SelectedZeitprofil, Converter={x:Static ObjectConverters.IsNotNull}}">
                            <StackPanel Spacing="20">
                                <TextBlock Text="FEIERTAGS-KONFIGURATION" Classes="Label"/>

                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="200"/>
                                        <ColumnDefinition Width="24"/>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="200"/>
                                        <ColumnDefinition Width="24"/>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="200"/>
                                    </Grid.ColumnDefinitions>

                                    <TextBlock Grid.Column="0"
                                               Text="Bundesland"
                                               Classes="Body"
                                               FontWeight="Bold"
                                               VerticalAlignment="Center"
                                               Margin="0,0,12,0"/>

                                    <ComboBox Grid.Column="1"
                                              SelectedValue="{Binding ZeitprofileVM.SelectedZeitprofil.Bundesland}">
                                        <ComboBoxItem Content="BY - Bayern"/>
                                        <ComboBoxItem Content="BW - Baden-WÃ¼rttemberg"/>
                                        <ComboBoxItem Content="BE - Berlin"/>
                                        <ComboBoxItem Content="BB - Brandenburg"/>
                                        <ComboBoxItem Content="HB - Bremen"/>
                                        <ComboBoxItem Content="HH - Hamburg"/>
                                        <ComboBoxItem Content="HE - Hessen"/>
                                        <ComboBoxItem Content="MV - Mecklenburg-Vorpommern"/>
                                        <ComboBoxItem Content="NI - Niedersachsen"/>
                                        <ComboBoxItem Content="NW - Nordrhein-Westfalen"/>
                                        <ComboBoxItem Content="RP - Rheinland-Pfalz"/>
                                        <ComboBoxItem Content="SL - Saarland"/>
                                        <ComboBoxItem Content="SN - Sachsen"/>
                                        <ComboBoxItem Content="ST - Sachsen-Anhalt"/>
                                        <ComboBoxItem Content="SH - Schleswig-Holstein"/>
                                        <ComboBoxItem Content="TH - ThÃ¼ringen"/>
                                    </ComboBox>

                                    <TextBlock Grid.Column="3"
                                               Text="Region"
                                               Classes="Body"
                                               FontWeight="Bold"
                                               VerticalAlignment="Center"
                                               Margin="0,0,12,0"/>

                                    <TextBox Grid.Column="4"
                                             Text="{Binding ZeitprofileVM.SelectedZeitprofil.Region}"
                                             Watermark="z.B. Augsburg (optional)"/>

                                    <TextBlock Grid.Column="6"
                                               Text="Behandeln wie"
                                               Classes="Body"
                                               FontWeight="Bold"
                                               VerticalAlignment="Center"
                                               Margin="0,0,12,0"/>

                                    <ComboBox Grid.Column="7"
                                              SelectedValue="{Binding ZeitprofileVM.SelectedZeitprofil.BehandelnWie}">
                                        <ComboBoxItem Content="Sonntag"/>
                                        <ComboBoxItem Content="Samstag"/>
                                    </ComboBox>
                                </Grid>

                                <TextBlock Text="Feiertage werden automatisch berechnet und wie der gewÃ¤hlte Wochentag behandelt"
                                           Classes="Body"
                                           Foreground="{DynamicResource TextMutedBrush}"
                                           FontStyle="Italic"
                                           FontSize="13"/>
                            </StackPanel>
                        </Border>

                        <Border Classes="BentoCard"
                                IsVisible="{Binding ZeitprofileVM.SelectedZeitprofil, Converter={x:Static ObjectConverters.IsNotNull}}">
                            <StackPanel Spacing="16">
                                <TextBlock Text="ZUGEWIESENE BEREITSCHAFTSGRUPPEN" Classes="Label"/>

                                <DataGrid ItemsSource="{Binding ZeitprofileVM.SelectedZeitprofil.GruppenZuweisungen}"
                                          AutoGenerateColumns="False"
                                          IsReadOnly="True"
                                          Height="150">
                                    <DataGrid.Columns>
                                        <DataGridTextColumn Header="Gruppenname" Binding="{Binding GruppenName}" Width="*"/>
                                    </DataGrid.Columns>
                                </DataGrid>

                                <TextBlock Text="Gruppenzuweisungen kÃ¶nnen im Generator verwaltet werden"
                                           Classes="Body"
                                           Foreground="{DynamicResource TextMutedBrush}"
                                           FontStyle="Italic"
                                           FontSize="13"/>
                            </StackPanel>
                        </Border>
                    </StackPanel>

                    <!-- ====================================================================== -->
                    <!-- VIEW 3: GENERATOR -->
                    <!-- ====================================================================== -->
                    <Grid IsVisible="{Binding IsGeneratorView}">
                        <StackPanel Spacing="32" DataContext="{Binding GeneratorVM}">
                            <TextBlock Text="Erstellung" Classes="H1"/>
                            <TextBlock Text="AUTOMATISCHE DIENST-ERSTELLUNG" Classes="Label"/>

                            <Border Classes="BentoCard">
                                <StackPanel Spacing="24">
                                    <TextBlock Text="ZEITRAUM-AUSWAHL" Classes="Label"/>

                                    <StackPanel Orientation="Horizontal" Spacing="24">
                                        <RadioButton Content="Einzelne Tage (Von/Bis)"
                                                     IsChecked="{Binding UseDateRange}"
                                                     GroupName="DateMode"
                                                     FontWeight="Medium"
                                                     FontSize="14"/>
                                        <RadioButton Content="Kalenderwochen"
                                                     IsChecked="{Binding UseCalendarWeeks}"
                                                     GroupName="DateMode"
                                                     FontWeight="Medium"
                                                     FontSize="14"/>
                                    </StackPanel>

                                    <Grid IsVisible="{Binding UseDateRange}">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="200"/>
                                            <ColumnDefinition Width="24"/>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="200"/>
                                            <ColumnDefinition Width="24"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>

                                        <TextBlock Grid.Column="0"
                                                   Text="Von"
                                                   Classes="Body"
                                                   FontWeight="Bold"
                                                   VerticalAlignment="Center"
                                                   Margin="0,0,12,0"/>

                                        <DatePicker Grid.Column="1"
                                                    SelectedDate="{Binding StartDate}"/>

                                        <TextBlock Grid.Column="3"
                                                   Text="Bis"
                                                   Classes="Body"
                                                   FontWeight="Bold"
                                                   VerticalAlignment="Center"
                                                   Margin="0,0,12,0"/>

                                        <DatePicker Grid.Column="4"
                                                    SelectedDate="{Binding EndDate}"/>

                                        <StackPanel Grid.Column="6" Orientation="Horizontal" Spacing="8">
                                            <Button Content="Aktueller Monat"
                                                    Classes="SecondaryAction"
                                                    Command="{Binding SetDateRangeCurrentMonthCommand}"/>
                                            <Button Content="NÃ¤chster Monat"
                                                    Classes="SecondaryAction"
                                                    Command="{Binding SetDateRangeNextMonthCommand}"/>
                                            <Button Content="Aktuelles Quartal"
                                                    Classes="SecondaryAction"
                                                    Command="{Binding SetDateRangeCurrentQuarterCommand}"/>
                                        </StackPanel>
                                    </Grid>

                                    <StackPanel IsVisible="{Binding UseCalendarWeeks}" Spacing="16">
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="150"/>
                                                <ColumnDefinition Width="40"/>
                                                <ColumnDefinition Width="*"/>
                                            </Grid.ColumnDefinitions>

                                            <TextBlock Grid.Column="0"
                                                       Text="Jahr"
                                                       Classes="Body"
                                                       FontWeight="Bold"
                                                       VerticalAlignment="Center"
                                                       Margin="0,0,12,0"/>

                                            <ComboBox Grid.Column="1"
                                                      ItemsSource="{Binding AvailableYears}"
                                                      SelectedItem="{Binding SelectedYear}"/>

                                            <StackPanel Grid.Column="3" Orientation="Horizontal" Spacing="8">
                                                <Button Content="Q1"
                                                        Classes="SecondaryAction"
                                                        Command="{Binding SelectQuarterCommand}"
                                                        CommandParameter="1"/>
                                                <Button Content="Q2"
                                                        Classes="SecondaryAction"
                                                        Command="{Binding SelectQuarterCommand}"
                                                        CommandParameter="2"/>
                                                <Button Content="Q3"
                                                        Classes="SecondaryAction"
                                                        Command="{Binding SelectQuarterCommand}"
                                                        CommandParameter="3"/>
                                                <Button Content="Q4"
                                                        Classes="SecondaryAction"
                                                        Command="{Binding SelectQuarterCommand}"
                                                        CommandParameter="4"/>
                                                <Button Content="Alle um/abwÃ¤hlen"
                                                        Classes="SecondaryAction"
                                                        Command="{Binding ToggleAllKWCommand}"/>
                                            </StackPanel>
                                        </Grid>

                                        <TextBlock Text="{Binding SelectedKWCount, StringFormat={}{0} Kalenderwoche(n) ausgewÃ¤hlt}"
                                                   Classes="Body"
                                                   FontWeight="Bold"/>

                                        <Border BorderBrush="#F0F0F0"
                                                BorderThickness="1"
                                                CornerRadius="6"
                                                MaxHeight="200">
                                            <ScrollViewer>
                                                <ItemsControl ItemsSource="{Binding Kalenderwochen}">
                                                    <ItemsControl.ItemsPanel>
                                                        <ItemsPanelTemplate>
                                                            <WrapPanel Orientation="Horizontal"/>
                                                        </ItemsPanelTemplate>
                                                    </ItemsControl.ItemsPanel>
                                                    <ItemsControl.ItemTemplate>
                                                        <DataTemplate>
                                                            <CheckBox IsChecked="{Binding IsSelected}"
                                                                      Margin="8"
                                                                      Width="100">
                                                                <CheckBox.Content>
                                                                    <StackPanel>
                                                                        <TextBlock Text="{Binding DisplayText}"
                                                                                   FontWeight="Bold"
                                                                                   FontSize="13"/>
                                                                        <TextBlock Text="{Binding DateRange}"
                                                                                   FontSize="11"
                                                                                   Foreground="{DynamicResource TextMutedBrush}"/>
                                                                    </StackPanel>
                                                                </CheckBox.Content>
                                                            </CheckBox>
                                                        </DataTemplate>
                                                    </ItemsControl.ItemTemplate>
                                                </ItemsControl>
                                            </ScrollViewer>
                                        </Border>
                                    </StackPanel>

                                    <Separator Background="#F0F0F0" Height="1" Margin="0,8"/>

                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>

                                        <TextBlock Grid.Column="0"
                                                   Text="Ressource (Verantwortlich)"
                                                   Classes="Body"
                                                   FontWeight="Bold"
                                                   VerticalAlignment="Center"
                                                   Margin="0,0,16,0"/>

                                        <ComboBox Grid.Column="1"
                                                  ItemsSource="{Binding Ressourcen}"
                                                  SelectedItem="{Binding SelectedRessource}"
                                                  MinWidth="300"
                                                  HorizontalAlignment="Left"/>
                                    </Grid>
                                </StackPanel>
                            </Border>

                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="30"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <Border Grid.Column="0" Classes="BentoCard">
                                    <StackPanel Spacing="16">
                                        <TextBlock Text="VERFÃœGBARE GRUPPEN" Classes="Label"/>

                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="*"/>
                                            </Grid.ColumnDefinitions>

                                            <TextBlock Grid.Column="0"
                                                       Text="Bezirk"
                                                       Classes="Body"
                                                       FontWeight="Bold"
                                                       VerticalAlignment="Center"
                                                       Margin="0,0,12,0"/>

                                            <ComboBox Grid.Column="1"
                                                      ItemsSource="{Binding Bezirke}"
                                                      SelectedItem="{Binding SelectedBezirk}"/>
                                        </Grid>

                                        <TextBox Text="{Binding GruppenSuchtext}"
                                                 Watermark="Gruppen suchen"/>

                                        <ListBox ItemsSource="{Binding FilteredGruppen}"
                                                 SelectionMode="Multiple"
                                                 MinHeight="300">
                                            <ListBox.ItemTemplate>
                                                <DataTemplate>
                                                    <StackPanel Orientation="Horizontal" Spacing="12">
                                                        <Button Content="+"
                                                                Command="{Binding $parent[Grid].DataContext.AddGruppeCommand}"
                                                                CommandParameter="{Binding}"
                                                                Width="32"
                                                                Height="32"
                                                                Background="{DynamicResource AccentDeepBrush}"
                                                                Foreground="White"
                                                                CornerRadius="16"
                                                                FontSize="16"
                                                                FontWeight="Bold"
                                                                Padding="0"/>
                                                        <StackPanel>
                                                            <TextBlock Text="{Binding Name}" FontWeight="Bold" FontSize="14"/>
                                                            <TextBlock Text="{Binding Bezirk}"
                                                                       FontSize="12"
                                                                       Foreground="{DynamicResource TextMutedBrush}"/>
                                                        </StackPanel>
                                                    </StackPanel>
                                                </DataTemplate>
                                            </ListBox.ItemTemplate>
                                        </ListBox>

                                        <Button Content="Alle hinzufÃ¼gen"
                                                Classes="SecondaryAction"
                                                HorizontalAlignment="Stretch"
                                                Command="{Binding SelectAllFilteredCommand}"/>
                                    </StackPanel>
                                </Border>

                                <Border Grid.Column="2" Classes="BentoCard">
                                    <StackPanel Spacing="16">
                                        <TextBlock Text="AUSGEWÃ„HLTE GRUPPEN" Classes="Label"/>

                                        <ListBox ItemsSource="{Binding SelectedGruppen}"
                                                 MinHeight="300">
                                            <ListBox.ItemTemplate>
                                                <DataTemplate>
                                                    <StackPanel Orientation="Horizontal" Spacing="12">
                                                        <Button Content="-"
                                                                Command="{Binding $parent[Grid].DataContext.RemoveGruppeCommand}"
                                                                CommandParameter="{Binding}"
                                                                Width="32"
                                                                Height="32"
                                                                Background="#E0E0E0"
                                                                Foreground="{DynamicResource TextDarkBrush}"
                                                                CornerRadius="16"
                                                                FontSize="16"
                                                                FontWeight="Bold"
                                                                Padding="0"/>
                                                        <StackPanel>
                                                            <TextBlock Text="{Binding Name}" FontWeight="Bold" FontSize="14"/>
                                                            <TextBlock Text="{Binding Bezirk}"
                                                                       FontSize="12"
                                                                       Foreground="{DynamicResource TextMutedBrush}"/>
                                                        </StackPanel>
                                                    </StackPanel>
                                                </DataTemplate>
                                            </ListBox.ItemTemplate>
                                        </ListBox>

                                        <Button Content="Alle entfernen"
                                                Classes="SecondaryAction"
                                                HorizontalAlignment="Stretch"
                                                Command="{Binding ClearSelectionCommand}"/>
                                    </StackPanel>
                                </Border>
                            </Grid>

                            <Border Classes="BentoCard">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>

                                    <StackPanel Grid.Column="0" Spacing="8">
                                        <TextBlock Text="{Binding StatisticsText}"
                                                   Classes="H2"
                                                   FontSize="18"
                                                   Foreground="{Binding StatusColor}"/>
                                        <TextBlock Text="{Binding StatusMessage}"
                                                   Classes="Body"
                                                   Foreground="{Binding StatusColor}"/>
                                    </StackPanel>

                                    <Button Grid.Column="1"
                                            Content="Generieren"
                                            Classes="TrustAction"
                                            Command="{Binding GenerateCommand}"
                                            Width="200"
                                            Height="50"
                                            FontSize="18"
                                            IsEnabled="{Binding !IsGenerating}"/>
                                </Grid>
                            </Border>
                        </StackPanel>
                    </Grid>

                    <!-- ====================================================================== -->
                    <!-- VIEW 4: PLANNING BOARD -->
                    <!-- ====================================================================== -->
                    <ContentControl Content="{Binding PlanningBoardView}"
                                    IsVisible="{Binding IsPlanningView}"/>

                    <!-- ====================================================================== -->
                    <!-- VIEW 5: EDITOR -->
                    <!-- ====================================================================== -->
                    <Grid IsVisible="{Binding IsEditorView}">
                        <StackPanel Spacing="32" DataContext="{Binding EditorVM}">
                            <TextBlock Text="Editor" Classes="H1"/>
                            <TextBlock Text="BESTEHENDE DIENSTE BEARBEITEN" Classes="Label"/>

                            <Border Classes="BentoCard">
                                <StackPanel Spacing="16">
                                    <TextBlock Text="EXCEL-DATEI LADEN" Classes="Label"/>

                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="12"/>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="12"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>

                                        <TextBox Grid.Column="0"
                                                 Text="{Binding ExcelFilePath}"
                                                 IsReadOnly="True"
                                                 Watermark="Keine Datei ausgewÃ¤hlt"/>

                                        <Button Grid.Column="2"
                                                Content="Durchsuchen"
                                                Classes="SecondaryAction"
                                                Command="{Binding BrowseFileCommand}"/>

                                        <Button Grid.Column="4"
                                                Content="Laden"
                                                Classes="TrustAction"
                                                Command="{Binding LoadExcelCommand}"/>
                                    </Grid>
                                </StackPanel>
                            </Border>

                            <Border Classes="BentoCard"
                                    IsVisible="{Binding HasLoadedData}">
                                <StackPanel Spacing="20">
                                    <TextBlock Text="FILTER-OPTIONEN" Classes="Label"/>

                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="180"/>
                                            <ColumnDefinition Width="24"/>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="180"/>
                                            <ColumnDefinition Width="24"/>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="200"/>
                                        </Grid.ColumnDefinitions>

                                        <TextBlock Grid.Column="0"
                                                   Text="Von"
                                                   Classes="Body"
                                                   FontWeight="Bold"
                                                   VerticalAlignment="Center"
                                                   Margin="0,0,12,0"/>
                                        <DatePicker Grid.Column="1"
                                                    SelectedDate="{Binding FilterStartDate}"/>

                                        <TextBlock Grid.Column="3"
                                                   Text="Bis"
                                                   Classes="Body"
                                                   FontWeight="Bold"
                                                   VerticalAlignment="Center"
                                                   Margin="0,0,12,0"/>
                                        <DatePicker Grid.Column="4"
                                                    SelectedDate="{Binding FilterEndDate}"/>

                                        <TextBlock Grid.Column="6"
                                                   Text="Gruppe"
                                                   Classes="Body"
                                                   FontWeight="Bold"
                                                   VerticalAlignment="Center"
                                                   Margin="0,0,12,0"/>
                                        <ComboBox Grid.Column="7"
                                                  ItemsSource="{Binding Gruppen}"
                                                  SelectedItem="{Binding SelectedGruppeFilter}"/>
                                    </Grid>

                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="12"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>

                                        <TextBox Grid.Column="0"
                                                 Text="{Binding SearchText}"
                                                 Watermark="Suche nach Gruppe, Ressource, Typ"/>

                                        <StackPanel Grid.Column="2" Orientation="Horizontal" Spacing="8">
                                            <Button Content="Aktueller Monat"
                                                    Classes="SecondaryAction"
                                                    Command="{Binding SetFilterCurrentMonthCommand}"/>
                                            <Button Content="NÃ¤chster Monat"
                                                    Classes="SecondaryAction"
                                                    Command="{Binding SetFilterNextMonthCommand}"/>
                                            <Button Content="Filter zurÃ¼cksetzen"
                                                    Classes="SecondaryAction"
                                                    Command="{Binding ClearAllFiltersCommand}"/>
                                        </StackPanel>
                                    </Grid>
                                </StackPanel>
                            </Border>

                            <Border Classes="BentoCard">
                                <StackPanel Spacing="16">
                                    <TextBlock Text="{Binding FilteredCount, StringFormat='BEREITSCHAFTSDIENSTE ({0} EINTRÃ„GE)'}"
                                               Classes="Label"/>

                                    <DataGrid ItemsSource="{Binding FilteredBereitschaften}"
                                              SelectedItem="{Binding SelectedBereitschaft}"
                                              AutoGenerateColumns="False"
                                              IsReadOnly="False"
                                              MinHeight="350">
                                        <DataGrid.Columns>
                                            <DataGridTextColumn Header="ID" Binding="{Binding Id}" Width="60" IsReadOnly="True"/>
                                            <DataGridTextColumn Header="Datum" Binding="{Binding Datum, StringFormat='dd.MM.yyyy'}" Width="120"/>
                                            <DataGridTextColumn Header="Gruppe" Binding="{Binding GruppeName}" Width="*"/>
                                            <DataGridTextColumn Header="Ressource" Binding="{Binding RessourceName}" Width="*"/>
                                            <DataGridTextColumn Header="Von" Binding="{Binding StartZeit}" Width="80"/>
                                            <DataGridTextColumn Header="Bis" Binding="{Binding EndZeit}" Width="80"/>
                                            <DataGridTextColumn Header="Typ" Binding="{Binding Typ}" Width="60"/>
                                        </DataGrid.Columns>
                                    </DataGrid>

                                    <StackPanel HorizontalAlignment="Center"
                                                Spacing="12"
                                                IsVisible="{Binding !HasLoadedData}">
                                        <TextBlock Text="Keine Datei geladen"
                                                   Classes="H2"
                                                   FontSize="20"
                                                   Foreground="{DynamicResource TextMutedBrush}"
                                                   HorizontalAlignment="Center"/>
                                        <TextBlock Text="Bitte wÃ¤hle eine Excel-Datei aus und lade sie"
                                                   Classes="Body"
                                                   Foreground="{DynamicResource TextMutedBrush}"
                                                   HorizontalAlignment="Center"
                                                   FontStyle="Italic"/>
                                    </StackPanel>
                                </StackPanel>
                            </Border>

                            <Border Classes="BentoCard">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>

                                    <StackPanel Grid.Column="0" Spacing="8">
                                        <TextBlock Text="{Binding StatusMessage}"
                                                   Classes="H2"
                                                   FontSize="18"
                                                   Foreground="{Binding StatusColor}"/>
                                        <TextBlock Text="Ã„nderungen nicht gespeichert"
                                                   Classes="Body"
                                                   Foreground="{DynamicResource ErrorBrush}"
                                                   IsVisible="{Binding HasUnsavedChanges}"/>
                                    </StackPanel>

                                    <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="12">
                                        <Button Content="LÃ¶schen"
                                                Classes="SecondaryAction"
                                                Command="{Binding DeleteSelectedCommand}"
                                                IsEnabled="{Binding HasLoadedData}"/>

                                        <Button Content="Duplizieren"
                                                Classes="SecondaryAction"
                                                Command="{Binding DuplicateSelectedCommand}"
                                                IsEnabled="{Binding HasLoadedData}"/>

                                        <Button Content="Speichern"
                                                Classes="TrustAction"
                                                Command="{Binding SaveExcelCommand}"
                                                Width="160"
                                                Height="40"
                                                FontSize="16"
                                                IsEnabled="{Binding HasUnsavedChanges}"/>
                                    </StackPanel>
                                </Grid>
                            </Border>
                        </StackPanel>
                    </Grid>

                </Grid>
            </ScrollViewer>
        </Grid>
    </Grid>
</Window>
