<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:BereitschaftsPlaner.Avalonia.ViewModels"
             x:Class="BereitschaftsPlaner.Avalonia.Views.PlanningBoardView"
             x:DataType="vm:PlanningBoardViewModel"
             Background="{DynamicResource SurfaceBrush}"
             FontFamily="{DynamicResource SansFont}">

    <Design.DataContext>
        <vm:PlanningBoardViewModel/>
    </Design.DataContext>

    <Grid Margin="40">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>  <!-- Header -->
            <RowDefinition Height="*"/>     <!-- Main content -->
        </Grid.RowDefinitions>

        <!-- ============================================================================ -->
        <!-- HEADER -->
        <!-- ============================================================================ -->
        <StackPanel Grid.Row="0" Spacing="24" Margin="0,0,0,32">
            <!-- Row 1: Title + Month Navigation -->
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>  <!-- Title -->
                    <ColumnDefinition Width="*"/>      <!-- Spacer -->
                    <ColumnDefinition Width="Auto"/>  <!-- Month Nav -->
                </Grid.ColumnDefinitions>

                <!-- Title -->
                <TextBlock Grid.Column="0"
                           Text="Planung"
                           Classes="H1"
                           VerticalAlignment="Center"/>

                <!-- Month Navigation -->
                <StackPanel Grid.Column="2"
                            Orientation="Horizontal"
                            Spacing="12">
                    <Button Content="Zurück"
                            Classes="SecondaryAction"
                            Width="100"
                            Command="{Binding PreviousMonthCommand}"/>

                    <TextBlock Text="{Binding MonthTitle}"
                               Classes="H2"
                               VerticalAlignment="Center"
                               MinWidth="180"
                               TextAlignment="Center"/>

                    <Button Content="Weiter"
                            Classes="SecondaryAction"
                            Width="100"
                            Command="{Binding NextMonthCommand}"/>

                    <Button Content="Heute"
                            Classes="TrustAction"
                            Width="90"
                            Command="{Binding TodayCommand}"/>
                </StackPanel>
            </Grid>

            <!-- Row 2: Action Buttons -->
            <StackPanel Orientation="Horizontal" Spacing="12" HorizontalAlignment="Right">
                <Button Content="Auto-Fill"
                        Classes="TrustAction"
                        Width="100"
                        Command="{Binding AutoFillMonthCommand}"
                        ToolTip.Tip="Monat automatisch gleichmäßig planen"/>

                <Button Content="Fairness"
                        Classes="SecondaryAction"
                        Width="100"
                        Command="{Binding ShowFairnessDashboardCommand}"
                        ToolTip.Tip="Fairness-Analyse anzeigen"/>

                <Button Content="Export"
                        Classes="TrustAction"
                        Width="90"
                        Command="{Binding ExportToExcelCommand}"/>

                <Button Content="Löschen"
                        Classes="SecondaryAction"
                        Width="100"
                        Command="{Binding ClearAllCommand}"/>
            </StackPanel>
        </StackPanel>

        <!-- ============================================================================ -->
        <!-- MAIN CONTENT -->
        <!-- ============================================================================ -->
        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="280"/>  <!-- Left Panel -->
                <ColumnDefinition Width="*"/>     <!-- Calendar -->
            </Grid.ColumnDefinitions>

            <!-- ============================================================================ -->
            <!-- LEFT PANEL: Controls -->
            <!-- ============================================================================ -->
            <Border Grid.Column="0"
                    Classes="BentoCard"
                    Margin="0,0,24,0">
                <ScrollViewer>
                    <StackPanel Spacing="24">
                        <!-- Title -->
                        <TextBlock Text="KONFIGURATION"
                                   Classes="Label"/>

                        <!-- 1. Modus -->
                        <StackPanel Spacing="12">
                            <TextBlock Text="1. Modus wählen"
                                       Classes="H3"/>

                            <StackPanel Spacing="8">
                                <RadioButton Content="Bereitschaftsdienst (BD)"
                                             IsChecked="{Binding IsBD}"
                                             Classes="Body"
                                             GroupName="Modus"/>
                                <TextBlock Text="1 Person für alles"
                                           Classes="Body"
                                           Foreground="{DynamicResource TextMutedBrush}"
                                           FontStyle="Italic"
                                           Margin="24,0,0,0"/>

                                <RadioButton Content="Tagesdienst (TD)"
                                             IsChecked="{Binding IsTD}"
                                             Classes="Body"
                                             GroupName="Modus"/>
                                <TextBlock Text="Pro Bezirk 1 Person"
                                           Classes="Body"
                                           Foreground="{DynamicResource TextMutedBrush}"
                                           FontStyle="Italic"
                                           Margin="24,0,0,0"/>
                            </StackPanel>
                        </StackPanel>

                        <Separator Background="{DynamicResource BorderBrush}" Height="1"/>

                        <!-- 2. Gruppe -->
                        <StackPanel Spacing="12">
                            <TextBlock Text="2. Gruppe auswählen"
                                       Classes="H3"/>

                            <ComboBox ItemsSource="{Binding AvailableGroups}"
                                      SelectedItem="{Binding SelectedGroup}"
                                      DisplayMemberBinding="{Binding Name}"
                                      PlaceholderText="Gruppe wählen..."
                                      HorizontalAlignment="Stretch"/>

                            <TextBlock Text="{Binding AvailableGroups.Count, StringFormat='{}{0} Gruppen verfügbar'}"
                                       Classes="Body"
                                       Foreground="{DynamicResource TextMutedBrush}"
                                       FontStyle="Italic"/>
                        </StackPanel>

                        <Separator Background="{DynamicResource BorderBrush}" Height="1"/>

                        <!-- 3. Person -->
                        <StackPanel Spacing="12">
                            <TextBlock Text="3. Person auswählen"
                                       Classes="H3"/>

                            <ComboBox ItemsSource="{Binding AvailableRessourcen}"
                                      SelectedItem="{Binding SelectedRessource}"
                                      DisplayMemberBinding="{Binding Name}"
                                      PlaceholderText="Person wählen..."
                                      HorizontalAlignment="Stretch"/>

                            <TextBlock Text="{Binding AvailableRessourcen.Count, StringFormat='{}{0} Personen verfügbar'}"
                                       Classes="Body"
                                       Foreground="{DynamicResource TextMutedBrush}"
                                       FontStyle="Italic"/>
                        </StackPanel>

                        <Separator Background="{DynamicResource BorderBrush}" Height="1"/>

                        <!-- 4. Zuordnen -->
                        <StackPanel Spacing="12">
                            <TextBlock Text="4. Zuordnen"
                                       Classes="H3"/>

                            <Border Classes="BentoCard"
                                    Background="#FAFAFA"
                                    Padding="16">
                                <StackPanel Spacing="8">
                                    <TextBlock Text="So geht's:"
                                               Classes="H3"
                                               FontSize="12"/>

                                    <TextBlock Text="• Klicken Sie auf einen Tag"
                                               Classes="Body"
                                               FontSize="11"/>
                                    <TextBlock Text="• Oder auf KW X für ganze Woche"
                                               Classes="Body"
                                               FontSize="11"/>
                                    <TextBlock Text="• Person wird zugeordnet"
                                               Classes="Body"
                                               FontSize="11"/>
                                </StackPanel>
                            </Border>
                        </StackPanel>

                        <Separator Background="{DynamicResource BorderBrush}" Height="1"/>

                        <!-- Vacation Calendar -->
                        <StackPanel Spacing="12">
                            <Button Content="Urlaubskalender"
                                    Classes="SecondaryAction"
                                    Command="{Binding OpenVacationCalendarCommand}"
                                    HorizontalAlignment="Stretch"
                                    Height="40"/>
                            <TextBlock Text="Verwalte Urlaub und Verfügbarkeit"
                                       Classes="Body"
                                       Foreground="{DynamicResource TextMutedBrush}"
                                       FontStyle="Italic"
                                       TextWrapping="Wrap"/>
                        </StackPanel>

                        <Separator Background="{DynamicResource BorderBrush}" Height="1"/>

                        <!-- Templates -->
                        <StackPanel Spacing="12">
                            <TextBlock Text="TEMPLATES"
                                       Classes="Label"/>

                            <Button Content="Template speichern"
                                    Classes="SecondaryAction"
                                    Command="{Binding SaveTemplateCommand}"
                                    HorizontalAlignment="Stretch"
                                    Height="40"/>

                            <Button Content="Template laden"
                                    Classes="SecondaryAction"
                                    Command="{Binding LoadTemplateCommand}"
                                    HorizontalAlignment="Stretch"
                                    Height="40"/>
                        </StackPanel>

                        <Separator Background="{DynamicResource BorderBrush}" Height="1"/>

                        <!-- Export Settings -->
                        <StackPanel Spacing="12">
                            <TextBlock Text="EXPORT-EINSTELLUNGEN"
                                       Classes="Label"/>

                            <StackPanel Spacing="8">
                                <TextBlock Text="Zeilen pro Datei:"
                                           Classes="Body"/>

                                <NumericUpDown Value="{Binding ExportSplitLines}"
                                               Minimum="10"
                                               Maximum="1000"
                                               Increment="10"
                                               FormatString="0"/>

                                <TextBlock Text="Bei mehr Zeilen wird automatisch auf mehrere Dateien aufgeteilt"
                                           Classes="Body"
                                           Foreground="{DynamicResource TextMutedBrush}"
                                           FontStyle="Italic"
                                           FontSize="10"
                                           TextWrapping="Wrap"/>
                            </StackPanel>
                        </StackPanel>

                        <Separator Background="{DynamicResource BorderBrush}" Height="1"/>

                        <!-- Statistics -->
                        <Border Classes="BentoCard"
                                Background="#FAFAFA"
                                Padding="16">
                            <StackPanel Spacing="8">
                                <TextBlock Text="STATISTIK"
                                           Classes="Label"/>

                                <TextBlock Classes="Body">
                                    <Run Text="Zuordnungen: "/>
                                    <Run Text="{Binding Assignments.Count}" FontWeight="SemiBold"/>
                                </TextBlock>

                                <TextBlock Classes="Body">
                                    <Run Text="Monat: "/>
                                    <Run Text="{Binding MonthTitle}" FontWeight="SemiBold"/>
                                </TextBlock>
                            </StackPanel>
                        </Border>
                    </StackPanel>
                </ScrollViewer>
            </Border>

            <!-- ============================================================================ -->
            <!-- RIGHT PANEL: Calendar -->
            <!-- ============================================================================ -->
            <Border Grid.Column="1"
                    Classes="BentoCard">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>  <!-- Headers -->
                        <RowDefinition Height="*"/>     <!-- Days -->
                        <RowDefinition Height="Auto"/>  <!-- Status -->
                    </Grid.RowDefinitions>

                    <!-- Weekday Headers -->
                    <Grid Grid.Row="0" Margin="0,0,0,16">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <TextBlock Grid.Column="0" Text="MONTAG" Classes="Label" HorizontalAlignment="Center"/>
                        <TextBlock Grid.Column="1" Text="DIENSTAG" Classes="Label" HorizontalAlignment="Center"/>
                        <TextBlock Grid.Column="2" Text="MITTWOCH" Classes="Label" HorizontalAlignment="Center"/>
                        <TextBlock Grid.Column="3" Text="DONNERSTAG" Classes="Label" HorizontalAlignment="Center"/>
                        <TextBlock Grid.Column="4" Text="FREITAG" Classes="Label" HorizontalAlignment="Center"/>
                        <TextBlock Grid.Column="5" Text="SAMSTAG" Classes="Label" HorizontalAlignment="Center" Foreground="{DynamicResource TextMutedBrush}"/>
                        <TextBlock Grid.Column="6" Text="SONNTAG" Classes="Label" HorizontalAlignment="Center" Foreground="{DynamicResource TextMutedBrush}"/>
                    </Grid>

                    <!-- Days Grid -->
                    <ItemsControl Grid.Row="1" ItemsSource="{Binding MonthDays}">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <UniformGrid Columns="7" Rows="6"/>
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>

                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Border BorderBrush="{DynamicResource BorderBrush}"
                                        BorderThickness="1"
                                        Padding="8"
                                        Margin="1">
                                    <Border.Styles>
                                        <Style Selector="Border">
                                            <Setter Property="Background" Value="{DynamicResource SurfaceBrush}"/>
                                        </Style>
                                        <Style Selector="Border:pointerover">
                                            <Setter Property="Background" Value="{DynamicResource CardBrush}"/>
                                        </Style>
                                    </Border.Styles>

                                    <Grid>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>  <!-- Day number -->
                                            <RowDefinition Height="*"/>     <!-- Assignments -->
                                        </Grid.RowDefinitions>

                                        <!-- Day Number & Week -->
                                        <Grid Grid.Row="0" Margin="0,0,0,8">
                                            <TextBlock Text="{Binding DayNumber}"
                                                       Classes="H3"
                                                       FontWeight="{Binding DayFontWeight}"
                                                       Foreground="{Binding DayForeground}"
                                                       HorizontalAlignment="Left"
                                                       VerticalAlignment="Top"/>

                                            <TextBlock Text="{Binding WeekNumber}"
                                                       Classes="Body"
                                                       FontSize="9"
                                                       Foreground="{DynamicResource TextMutedBrush}"
                                                       HorizontalAlignment="Right"
                                                       VerticalAlignment="Top"/>
                                        </Grid>

                                        <!-- Assignments -->
                                        <ItemsControl Grid.Row="1" ItemsSource="{Binding Assignments}">
                                            <ItemsControl.ItemTemplate>
                                                <DataTemplate>
                                                    <Border Background="{Binding GroupColor}"
                                                            BorderBrush="{Binding ConflictBorderBrush}"
                                                            BorderThickness="2"
                                                            CornerRadius="4"
                                                            Padding="6,4"
                                                            Margin="0,4,0,0">
                                                        <TextBlock Text="{Binding RessourceName}"
                                                                   Classes="Body"
                                                                   FontSize="10"
                                                                   TextTrimming="CharacterEllipsis"
                                                                   ToolTip.Tip="{Binding DisplayText}"/>
                                                    </Border>
                                                </DataTemplate>
                                            </ItemsControl.ItemTemplate>
                                        </ItemsControl>

                                        <!-- Today Indicator -->
                                        <Border Grid.Row="0"
                                                Grid.RowSpan="2"
                                                BorderBrush="{DynamicResource AccentDeepBrush}"
                                                BorderThickness="2"
                                                CornerRadius="4"
                                                IsVisible="{Binding IsToday}"/>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>

                    <!-- Status Bar -->
                    <Border Grid.Row="2"
                            Background="#FAFAFA"
                            Padding="16,12"
                            Margin="0,16,0,0"
                            CornerRadius="8">
                        <TextBlock Text="{Binding StatusMessage}"
                                   Classes="Body"
                                   Foreground="{Binding StatusColor}"/>
                    </Border>
                </Grid>
            </Border>
        </Grid>
    </Grid>
</UserControl>
